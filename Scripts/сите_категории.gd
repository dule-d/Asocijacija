extends Control

# Nodes
@onready var color_rect_countdown = $"ColorRect_Countdown"
@onready var color_rect_timer = $"ColorRect_Timer"
@onready var timer_label = $"ColorRect_Timer/Label"

# Node for Main Word
@onready var main_word_label = $Words
var used_words = []

# Timer variables
var countdown_values = ["3", "2", "1",]
var countdown_index = 0
var timer_value = 180  # 3 minutes (180 seconds)



var categories = {

	"Сите категории": [	"", "", "", "", "", "", "", "", "", "",  
						"", "", "", "", "", "", "", "", "", "",
	 					"", "", "", "", "", "", "", "", "", "",  
						"", "", "", "", "", "", "", "", "", "",
	  					"", "", "", "", "", "", "", "", "", "", 
						"", "", "", "", "", "", "", "", "", "",
	   					"", "", "", "", "", "", "", "", "", "", 
						"", "", "", "", "", "", "", "", "", "",
	   					"", "", "", "", "", "", "", "", "", "", 
						"", "", "", "", "", "", "", "", "", "",
						],

	"Предмети": [	"Молив", "Пенкало", "Гума", "Линијар", "Ножици", "Тефтер", "Тетратка", "Маркер", "Лаптоп", "Телефон",
					"Таблет", "Слушалки", "Звучник", "Чинија", "Вилушка", "Лажица", "Нож", "Чаша", "Шолја", "Тенџере",
	 				"Сапун", "Шампон", "Четка за заби", "Паста за заби", "Тoалетна хартија", "Метла", "Ранац", "Клуч", "Прстен", "Вртоврска",
					"Чевли", "Чoрапи", "Капа", "Јакна", "Очила за сонце", "Светилка", "Биро", "Рамка", "Игли за плетење", "Чекан",
	  				"Кеса за ѓубре", "Мече", "Играчка", "Домино", "Карти", "Шах", "Перница", "Кебе", "Чаршав", "Тепих", 
					"Маска", "Лепило", "Магнет", "Крпа", "Отворач за шишиња", "Крем за лице", "Фен", "Чешел", "Парфем", "Пасош",
	   				"Чадор", "Компас", "Маса", "Стол", "Шише вода", "Сок", "Звучник", "Палома", "Блуза", "Пантолони", 
						],

	"Животни": [	"Лав", "Тигар", "Мечка", "Волк", "Лисица", "Зајак", "Еж", "Мачка", "Куче", "Коњ", 
					"Крава", "Овца", "Коза", "Кокошка", "Петел", "Ној", "Патка", "Гуска", "Лебед", "Орел",
	 				"Гулаб", "Паун", "Пингвин", "Делфин", "Кит", "Ајкула", "Риба", "Жаба", "Гуштер", "Змија", 
					"Глушец", "Крокодил", "Коала", "Слон", "Жирафа", "Носорог", "Мајмун", "Горила", "Јагуар", "Панда",
	  				"Свиња", "Пајак", "Мува", "Комарeц", "Пеперутка", "Оса", "Пчела", "Полжав", "Желка", "Морска ѕвезда", 
					"Медуза", "Октопод", "Рак", "Камила", "Магаре", "Фока", "Патка ", "Јарец", "Ластовичка",
					],

	"Професии": [	"Доктор", "Сестра", "Ветеринар", "Фармацевт", "Учител", "Психолог", "Логопед", "Научник", "Менаџер", "Секретар", 
					"Банкар", "Сметководител", "Адвокат", "Полицаец", "Пожарникар", "Војник", "Архитект", "Електричар", "Водоинсталатер", "Молер",
	 				"Програмер", "Уметник", "Фотограф", "Музичар", "Писател", "Готвач", "Келнер", "Туристички водич", "Рецепционер", "Инспектор", 
					"Возач", "Пилот", "Механичар", "Доставувач", "Фармер", "Ловец", "Градинар", "Шумар", "Еколог", "Глумец",
	  				"Режисер", "Новинар", "Продавач", "Стјуардеса", "Морнар", "Рибар", "Биолог", "Физичар", "Фризер", "Спортист", 
					"Судија", "Лимар", "Преведувач", "Волонтер", "Јутјубер", "ТикТокер",
					],

	"Луѓе": [		"", "", "", "", "", "", "", "", "", "", 
					"", "", "", "", "", "", "", "", "", "",
	 				"", "", "", "", "", "", "", "", "", "", 
					"", "", "", "", "", "", "", "", "", "",
	  				"", "", "", "", "", "", "", "", "", "", 
					"", "", "", "", "", "", "", "", "", "",
	   				"", "", "", "", "", "", "", "", "", "", 
					"", "", "", "", "", "", "", "", "", "",
	   				"", "", "", "", "", "", "", "", "", "", 
					"", "", "", "", "", "", "", "", "", "",
					],

	"Храна": [		"Јаболко", "Банана", "Портокал", "Јагоди", "Диња", "Јагода", "Цреша", "Праска", "Лубеница", "Круша", 
					"Домат", "Краставица", "Морков", "Пиперка", "Компир", "Кромид", "Грав", "Леб", "Ориз", "Пилешко",
	 				"Свинско", "Лосос", "Риба", "Кавиар", "Туна", "Октопод", "Сирење", "Јогурт", "Млеко", "Кашкавал", 
					"Пченка", "Јачмен", "Вода", "Лимонада", "7Up", "Coca Cola", "Sprite", "Fanta", "Pepsi", "Чај",
	  				"Киселавода", "Синалко", "Кафе", "White Monster", "Red Bull", "Чоколадо", "Пиво", "Вино", "Вотка", "Виски", 
					"Цеден Сок", "Ракија", "Мед", "Тиква", "Слатки", "Кебап", "Палачинки", "Nutela", "Пица", "Врап",
	   				"Торта", "Трилече", "Кифли", "Сладолед", "Sex on the beatch",
					],

	"Активноски ": ["Трчање", "Скокање", "Пливање", "Танцување", "Пешачење", "Качување", "Скијање", "Сноуборд", "Јога", "Карате", 
					"Џудо", "Тенис", "Одбојка", "Кошарка", "Фудбал", "Голф", "Боулинг", "Бадминтон", "Пинг-понг", "Гимнастика",
	 				"Балет", "Патување", "Кампување", "Планинарење", "Лов", "Сурфање", "Сликање", "Цртање", "Пишување", "Читање", 
					"Играње", "Шах", "Карти", "Покер", "Коцкање", "Готвење", "Шиење", "Плетење", "Кодирање", "Пеење",
	  				"Масажа", "Крцање", "Одмор", "Спиење", "Гледање филм", "Капење", "Мијање на зами", "Мијање Лице", "Пазарење", "Поправање", 
					"Одговарање",
					],

	"Држави ": [	"Македонија", "Албанија", "Белгија", "Бугарија", "Хрватска", "Чешка", "Финска", "Франција", "Германија", "Италија", 
					"Шпанија", "Португалија", "Србија", "Романија", "Полска", "Швајцарија", "Австрија", "Холандија", "Норвешка", "Исланд",
	 				"Велика Британија", "Кина", "Јапонија", "Јужна Кореја", "Северна Кореја", "Индија", "Тајланд", "Египет", "Нигерија", "Мадагаскар", 
					"САД", "Канада", "Мексико", "Бразил", "Аргентина", "Јамајка", "Хаваи", "Куба", "Австралија", "Нов Зеланд",
					],

	"Спорт ": [		"Фудбал", "Кошарка", "Одбојка", "Ватерполо", "Хокеј", "Одбојка", "Фризби", "Пинг-понг", "Мечување", "Голф", 
					"Тенис", "Бадминтон", "Голф", "Пливање", "Гимнастика", "Кик-бокс", "Бокс", "Џудо", "Карате", "Сумо",
	 				"Сноуборд", "Скијање", "Скијање", "Паркур", "Дрифтинг", "Суфрање", "Санкање", "Шах", "Боулинг", "Дама",
					],

	#"Градови ": [	"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	# 				"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#  				"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#   			"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#   			"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#				],

	#"Автомобили ": ["", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	# 				"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#  				"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#   			"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#   			"", "", "", "", "", "", "", "", "", "", 
	#				"", "", "", "", "", "", "", "", "", "",
	#				],

	#"Главни Градови ": ["", "", "", "", "", "", "", "", "", "", 
	#					"", "", "", "", "", "", "", "", "", "",
	#					"", "", "", "", "", "", "", "", "", "", 
	#					"", "", "", "", "", "", "", "", "", "",
	#  					"", "", "", "", "", "", "", "", "", "", 
	#					"", "", "", "", "", "", "", "", "", "",
	#   				"", "", "", "", "", "", "", "", "", "", 
	#					"", "", "", "", "", "", "", "", "", "",
	#   				"", "", "", "", "", "", "", "", "", "", 
	#					"", "", "", "", "", "", "", "", "", "",
	#					],

	
}


#THIS IS FOR THE TIMER
#THIS IS FOR THE TIMER
#THIS IS FOR THE TIMER
#THIS IS FOR THE TIMER
func _ready() -> void:
	start_countdown()
	randomize()
	display_random_word("Предмети")

func display_random_word(category_name: String) -> void:
	if not categories.has(category_name):
		print("categorie not found")
		return

	var available_words = []
	for word in categories[category_name]:
		if word not in used_words:
			available_words.append(word)

	if available_words.size() == 0:
		print("All words have been used!")	
		main_word_label.text = "No more words!"
		return

	var random_word = available_words[randi() % available_words.size()]
	main_word_label.text = random_word
	used_words.append(random_word)
	print("Random Word:", random_word)



func reset_used_words():
	used_words.clear()



# Start the countdown effect (3, 2, 1, START)
func start_countdown() -> void:
	countdown_index = 0
	color_rect_countdown.visible = true
	update_countdown_text()
	await get_tree().create_timer(1.0).timeout
	continue_countdown()

# Continue the countdown until "START"
func continue_countdown() -> void:
	countdown_index += 1

	if countdown_index < countdown_values.size():
		update_countdown_text()
		await get_tree().create_timer(1.0).timeout
		continue_countdown()
	else:
		color_rect_countdown.visible = false
		start_timer()

# Update the countdown text (3, 2, 1, START)
func update_countdown_text() -> void:
	color_rect_countdown.get_child(0).text = countdown_values[countdown_index]

# Start the main timer (3 minutes by default)
func start_timer() -> void:
	color_rect_timer.visible = true
	update_timer_text()
	await get_tree().create_timer(1.0).timeout
	_on_timer_tick()

# Update the timer text (MM:SS format)
func update_timer_text() -> void:
	var minutes = int(timer_value / 60)
	var seconds = int(timer_value % 60)
	timer_label.text = "%02d:%02d" % [minutes, seconds]

# Timer tick (counting down)
func _on_timer_tick() -> void:
	timer_value -= 1
	update_timer_text()

	if timer_value > 0:
		await get_tree().create_timer(1.0).timeout
		_on_timer_tick()
	else:
		_on_timer_end()

# Timer end (loads next scene)
func _on_timer_end() -> void:
	get_tree().change_scene("res://YourNextScene.tscn")
